---
layout:post
title: PHP网络爬虫
descript: 从小说网站中爬取小说并保存到txt文件中
tag: PHP爬虫
---

## 预备知识

> 1. 开启PHP的ssl扩展，才能爬取https网站的内容   **将对应的文件复制修改等网上教程很多，如果还无法开启ssl，那么php没有正确配置，需将php路径添加到环境变量中去**
>
> 2. `file_get_contents(url)` 从文件中读取字符串
>
> 3. `file_put_contents(file)`把字符串写入文件中 **返回数据的字节数**
>
> 4. Regester 正则表达式书写 推荐一款正则表达式书写软件 [Regester](https://deerchao.net/tools/regester/index.htm)
>
> 5. php使用正则表达式`preg_match()` `preg_match_all`
>
>    `preg_match($pattern,$subject,$matches)` $matches将被填充筛选后的结果 
>
>    `preg_match_all`

获取小说网站源码，将`https://`替换为`view-source:`

```php
<?php
	$url = "https://read.qidian.com/chapter/BZ6LutP2WyBkYmJ6CncUig2/0AYtwCo-nI76ItTi_ILQ7A2";
	$html = file_get_contents($url);
	$reg = '#<title>(?<title>.*?)</title>[\s\S]*?<div class="read-content j_readContent">(?<content>[\s\S]*?)</div>#';
	preg_match($reg,$html,$mat);
	$mat['content'] = preg_replace("#<.*?>#","\r\n",$mat['content']);
	if(file_put_contents($mat['title'].".txt",$mat['content'])){
		echo "小说成功获取啦";
	}
?> 
```

解析：

> 1. `file_get_contents(url)`获取目标网址的源码，保存到`$html`变量中
> 2. `preg_match()`参数为正则表达式、目标字符串、筛选结果保存的变量
> 3. `preg_repalce()` 将筛选出的文本中html代码替换为换行符
> 4. `file_put_contents()` 将筛选出的文本写入自定的文件中